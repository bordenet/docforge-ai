# AI Agent Guidelines - docforge-ai

> **Generated by**: [golden-agents](https://github.com/bordenet/golden-agents) v1.4.0 (progressive)
> **Last Updated**: 2026-02-10
> **Languages**: javascript
> **Type**: web-apps

Minimal core with on-demand module loading. Templates at: `$HOME/.golden-agents/templates/`

<!-- GOLDEN:framework:start -->

---

## Quality Gates (MANDATORY)

Before ANY commit:
1. **Lint**: `npm run lint` (zero warnings)
2. **Test**: `npm test`
3. **Coverage**: Minimum 80%

**Order matters.** Lint ‚Üí Test. Never skip steps.

---

## Communication Rules

- **No flattery** - Skip "Great question!" or "Excellent point!"
- **No hype** - Avoid "revolutionary", "game-changing", "seamless"
- **Evidence-based** - Cite sources or qualify as opinion
- **Direct** - State facts without embellishment

**Banned phrases**: production-grade, world-class, leverage, utilize, incredibly, extremely, Happy to help!

---

## üö® Progressive Module Loading

**STOP and load the relevant module BEFORE these actions:**

### Language Modules (üî¥ Required)
- üî¥ **BEFORE writing ANY `.js`, `.ts`, `.jsx`, `.tsx` file**: Read `$HOME/.golden-agents/templates/languages/javascript.md`

### Workflow Modules (üî¥ Required)
- üî¥ **BEFORE any commit, PR, push, or merge**: Read `$HOME/.golden-agents/templates/workflows/security.md`
- üî¥ **WHEN tests fail OR after 2+ failed fix attempts**: Read `$HOME/.golden-agents/templates/workflows/testing.md`
- üî¥ **WHEN build fails OR lint errors appear**: Read `$HOME/.golden-agents/templates/workflows/build-hygiene.md`
- üü° **BEFORE deploying to any environment**: Read `$HOME/.golden-agents/templates/workflows/deployment.md`
- üü° **WHEN conversation exceeds 50 exchanges**: Read `$HOME/.golden-agents/templates/workflows/context-management.md`

### Project type guidance:
- Read `$HOME/.golden-agents/templates/project-types/web-apps.md`

### Optional: Superpowers integration

If [superpowers](https://github.com/obra/superpowers) is installed, run at session start:

```bash
node ~/.codex/superpowers-augment/superpowers-augment.js bootstrap
```

<!-- GOLDEN:framework:end -->

---

## Project-Specific Rules

<!-- Add project-specific guidance below this line -->

### Architecture

DocForge is a plugin-based document generation platform:

- **9 document types** as plugins in `plugins/{type}/`
- **3-phase workflow**: Claude drafts ‚Üí Gemini critiques ‚Üí Claude synthesizes
- **Per-plugin IndexedDB** for data isolation

### Plugin Structure

Each plugin in `plugins/{type}/` contains:

```
config.js           # Form fields, scoring dimensions, metadata
templates.js        # Quick-start templates
prompts/            # phase1.md, phase2.md, phase3.md
js/
  validator.js      # Main entry point (exports validateDocument)
  validator-config.js    # Pattern definitions
  validator-detection.js # Detection functions
  validator-scoring.js   # Scoring functions
```

### Adding New Document Types

> **REQUIRED READING:** See `docs/ADDING-DOCUMENT-TYPES.md` for step-by-step instructions.

The guide covers:
- Plugin config structure
- Form field ‚Üí prompt placeholder mapping
- LLM prompt templates (all 3 phases)
- Validator implementation patterns
- Test requirements (20+ tests minimum)
- Plugin registry wiring
- Common mistakes to avoid
- AI agent checklist

---

## Agent Definitions

### Agent: DraftGenerator (Phase 1)

**Purpose**: Generate initial document draft from form inputs
**Domain**: Document creation
**LLM**: Claude (user's choice of model)

| Capability | Allowed | Constraints |
|------------|---------|-------------|
| Read form data | ‚úÖ | All fields from config.js |
| Generate markdown | ‚úÖ | Must follow template structure |
| Access external APIs | ‚ùå | Prompt is copy-pasted by user |

**Inputs**: Form field values (JSON), document type, template selection
**Outputs**: Markdown document following plugin's template structure

### Agent: AdversarialCritic (Phase 2)

**Purpose**: Score and critique the draft on 5 dimensions
**Domain**: Document quality assessment
**LLM**: Gemini (different model for adversarial perspective)

| Capability | Allowed | Constraints |
|------------|---------|-------------|
| Read Phase 1 output | ‚úÖ | Full draft text |
| Score dimensions | ‚úÖ | 1-5 scale per dimension |
| Identify gaps | ‚úÖ | Must cite specific sections |
| Rewrite content | ‚ùå | Critique only, no rewrites |

**Inputs**: Phase 1 draft, scoring dimensions from config.js
**Outputs**: Dimension scores (1-5), gap analysis, improvement suggestions

### Agent: Synthesizer (Phase 3)

**Purpose**: Incorporate critique into final document
**Domain**: Document refinement
**LLM**: Claude (same as Phase 1 for consistency)

| Capability | Allowed | Constraints |
|------------|---------|-------------|
| Read Phase 1 + 2 | ‚úÖ | Draft and critique |
| Rewrite sections | ‚úÖ | Address all critique points |
| Add new content | ‚úÖ | Only to fill identified gaps |
| Remove content | ‚ö†Ô∏è | Only if critique flags as wrong |

**Inputs**: Phase 1 draft, Phase 2 critique
**Outputs**: Final document with all critique points addressed

---

## Operating Constraints

**Privacy**: Drafts stored locally in browser (IndexedDB). User controls when prompts are sent to external AI services.
**Cost**: User controls LLM costs (copy-paste workflow to external AI, not API).
**Token Limits**: Prompts designed for 8K-32K context windows.

---

## Document Type Isolation (CRITICAL)

When working on a specific document type (one-pager, prd, adr, etc.):

| Rule | Description |
|------|-------------|
| **File scope** | ONLY modify files in `plugins/<document-type>/` |
| **Test scope** | ONLY modify tests in `tests/<document-type>-*.test.js` |
| **No cross-type changes** | If you identify improvements for OTHER document types, document them but DO NOT implement |
| **Commit scope match** | Use commit message scope that matches files modified |

### üéØ Mandatory Scope Declaration (SESSION START)

**BEFORE doing any work on a document type, you MUST declare your scope:**

```
## üéØ Working Scope Declaration

**Document Type:** [one-pager | prd | adr | jd | pr-faq | strategic-proposal | business-justification | acceptance-criteria | power-statement]

**Allowed Files:**
- `plugins/<type>/*`
- `tests/<type>-*.test.js`

**Forbidden Files:** All other `plugins/*` and `tests/*` directories

I acknowledge I will NOT modify files outside this scope.
```

**For cross-plugin work, use:**
```
**Document Type:** cross-plugin
**Scope:** [List specific types being modified]
```

### Pre-Action File Verification (BEFORE EACH EDIT)

**BEFORE modifying ANY file in `plugins/` or `tests/`, verify:**

1. ‚úÖ Does this file path contain my declared document type?
2. ‚úÖ If NO ‚Üí **STOP** and use spillover handling below
3. ‚úÖ If YES ‚Üí Proceed with modification

**Example verification:**
- Declared scope: `prd`
- File to edit: `plugins/one-pager/js/validator.js`
- Check: Does `plugins/one-pager/` contain `prd`? **NO**
- Action: **STOP** - document in spillover backlog, do not implement

### Spillover Handling Protocol

When you identify improvements for OTHER document types:

1. **DO NOT** implement the improvement
2. **DO** add an entry to `docs/SPILLOVER_BACKLOG.md`:

```markdown
| Date | Your Scope | Target Type | Improvement | Rationale |
|------|------------|-------------|-------------|-----------|
| YYYY-MM-DD | prd | one-pager | Add urgency detection | Similar to PRD competitive section |
```

3. **DO** continue with your declared scope work

### Defense-in-Depth Layers

| Layer | When | Action |
|-------|------|--------|
| **Scope declaration** | Session start | Establishes boundaries |
| **Pre-action verification** | Before each edit | Verifies file belongs to scope |
| **Spillover backlog** | When cross-type improvement found | Documents without implementing |
| **commit-msg hook** | At commit time | Rejects cross-contaminated commits |

If you bypass the first 3 layers, the hook will reject your commit. Do not attempt to bypass.

### Commit Message Scope Examples

| Scope | Allowed Files | Forbidden Files |
|-------|--------------|-----------------|
| `feat(prd):` | `plugins/prd/*`, `tests/prd-*` | `plugins/one-pager/*`, `plugins/adr/*` |
| `feat(one-pager):` | `plugins/one-pager/*`, `tests/one-pager-*` | `plugins/prd/*`, `plugins/adr/*` |
| `feat(adr):` | `plugins/adr/*`, `tests/adr-*` | `plugins/prd/*`, `plugins/one-pager/*` |
| `feat(shared):` | `shared/*`, multiple plugins | Any combination |
| `feat:` (no scope) | Cross-cutting changes | - |

### Branch Naming Policy

| Work Type | Branch Pattern | Example |
|-----------|----------------|---------|
| One-pager work | `feature/one-pager/*` | `feature/one-pager/validator-improvements` |
| PRD work | `feature/prd/*` | `feature/prd/competitive-landscape` |
| ADR work | `feature/adr/*` | `feature/adr/madr-3-upgrade` |
| Cross-plugin | `feature/cross-plugin/*` | `feature/cross-plugin/shared-patterns` |
| Bug fixes | `fix/<scope>/*` | `fix/prd/scoring-bug` |

### Git Hooks

Install cross-contamination prevention hooks:

```bash
git config core.hooksPath .githooks
```

This enables the `commit-msg` hook that validates scope matches files. See `.githooks/README.md` for details.

### Why This Matters

Cross-contamination (modifying multiple document types in one commit) causes:
- Merge conflicts when parallel agents work on different document types
- Mislabeled commit history making debugging harder
- Potential for one agent's changes to overwrite another's

See `PARALLEL_AGENT_REMEDIATION.md` for a detailed case study.

---

## Quality Standards

- **Coverage target**: 80% (currently 84%)
- **Lint clean**: `npm run lint` must pass with zero warnings
- **Prompt templates**: Include anti-slop guidance in all phase prompts

### Git Identity

```bash
git config user.name "Matt J Bordenet"
git config user.email "bordenet@users.noreply.github.com"
```

